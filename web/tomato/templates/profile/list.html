{% extends "base.html" %}

{% load url from future %}
{% load tomato %}

{% block title %}
<title>Device Profiles - ToMaTo Testbed</title>
{% endblock %}

{% block content %}
<h1>Device Profiles</h1>

<div class="btn-group">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
  	<span class="glyphicon glyphicon-filter"></span>
    {% if type %}
      Showing all device profiles of type '{{type}}'
    {% else %}
      Showing all device profiles
    {% endif %}
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
    <li><a href="{% url "profile_list" %}">Show all device profiles</a></li>
    <li class="divider"></li>
    {% for name, label in types_dict.iteritems %}
      <li><a href="{% url "profile_list_bytype" type=name %}">Show all device profiles of type '{{label}}'</a></li>    
    {% endfor %}
  </ul>
</div>

<div class="skip-sm"></div>

{% if profile_list|length > 10 and request.session.user.isGlobalHostManager %}
<form>
  <button type="submit" 
  {% if type %}
  	formaction="{%url "profile.add" type%}"
  {%else%}
  	formaction="{%url "profile.add"%}"
  {%endif%}
  class="btn btn-success"><span class="glyphicon glyphicon-plus"></span> Add device profile</button>
</form>
{% endif %}

{% if profile_list %}
	<script src="/js/enhancetable.js"></script>
	
	<table class="sortable,filterable table table-striped">
	  <tr>
		<th class="icononly">type</th>
		<th>Name</th>
		<th>Label</th>
		<th>Disk Space</th>
		<th>RAM</th>
		<th>CPUs</th>
		<th>Preference</th>
		<th class="icononly" />
	  </tr>
	{% for profile in profile_list %}
	  <tr>
	  	<td enhancetable_customkey="{{profile.type}}" align="right" class="icononly">
	  		<img src="/img/{{profile.type}}16.png" title="{{types_dict|get:profile.type}}" />
		</td>
	    <td><a href="{%url "profile.info" profile.id%}">{{profile.name}}</a></td>
	    <td>{{profile.label}}</td>
		<td>
			{% if profile.type != 'repy' %}
				{{profile.diskspace}} MB
			{% endif %}
		</td>
		
		<td>{{profile.ram}} MB</td>
		<td>{{profile.cpus}}</td>
		<td>{{profile.preference}}</td>
		<td class="icononly">
		<div class="hoverdescription">
			{% if profile.description %}
				<img src="/img/info.png" alt="i" />
		    {% else %}
		    	<img src="/img/invisible16.png" />
			{% endif %}
			
			{% if profile.restricted %}
		    	<img src="/img/lock.png" />
		    {% else %}
		    	<img src="/img/invisible16.png" />
		    {% endif %}
			
			<div class="hiddenbox"><table>
				{% if profile.description %}
					<tr><td><img src="/img/info.png" /></td><td>{{ profile.description|linebreaks|escape|simpletags:"b i em strong"|safe }}</td></tr>
				{% endif %}
				
				{% if profile.restricted %}
					<tr><td><img src="/img/lock.png" /></td><td>This profile is restricted. It can only be used by users with the "Restricted Profiles" flag.</td></tr>
				{% endif %}
			</table></div>
		</div>		    
	  </tr>
	{% endfor %}
	
	</table>
{% else %}
	<p>No profiles</p>
{% endif %}

{% if request.session.user.isGlobalHostManager or request.session.user.isGlobalAdmin  %}
<form>
  <button type="submit" 
  {% if type %}
  	formaction="{%url "profile.add" type%}"
  {%else%}
  	formaction="{%url "profile.add"%}"
  {%endif%}
  class="btn btn-success"><span class="glyphicon glyphicon-plus"></span> Add device profile</button>
</form>
{% endif %}


{% endblock %}
